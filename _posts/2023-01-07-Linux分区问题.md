## 遇见的问题

公司的云服务器上的硬盘容量为2tb，后来选择了直接扩容硬盘容量，但是发现无法继续使用fdisk进行分区并挂载。(非本人所为，公司之前没有专人运维)

4000G的硬盘现在只使用了2tb，其余空间暂时无法利用。三台服务器大概浪费了6000G硬盘空间，换算价格在50000元。如果选择重启需要中断业务，公司还要承担另外的损失，领导非常不乐意。

作为一个运维，自然而然的成了背锅侠，领导给了最终指示，等容量不够的时候再去解决，现在暂时就这样。

## 关于运维

讲真的，出现这种问题大部分都是因为没有专人运维造成的，因为他们可能并不知道上面的提示到底意味着什么意思。这也是很多公司非常杂乱，运维看了都觉得头疼的原因。还有就是背锅的问题，如果说跟运维没有关系，领导觉得我既然让你过来做运维你告诉我现在没办法解决，那我要运维有什么意义。如果说跟运维有关系，现在的技术根本达不到从MBR分区直接换到GPT分区还不影响线上业务。

我希望每个运维的兄弟，做自己的工作的时候多想想后面的兄弟，不要让人背地里骂娘。咱们都有点职业操守，基本的职业道德还是要遵守的。我之前遇见过运维的兄弟留了一堆坑让我解决的，我只能说，兄弟咱们吃这行的饭你这上来就要掀桌子多少有点不道德了。虽然我骂你你是听不见了，但是咱们仔细想想，真的好吗？

## 问题解决方案选定及过程

上来就是单纯吐槽，也正是有这些遗留问题才能显出我们的能力，运维不能解决问题还叫什么运维。

公司买的服务器是百度云的，既然花钱买了服务肯定第一时间找他们了。百度云给的意见是我们重新买硬盘挂载，然后把现在正在使用的硬盘里的数据转移到新的硬盘，然后卸载销毁退还(如果不使用LVM扩容分区的话，对于目录扩容的常规方式就是这样。但是我遇见的问题就是费用太高了，这种一下子好几w的支出，咱们运维肯定是做不了决定的)。研究了一下，领导直接否定了，虽然还可以退还但是移动文件都是个麻烦事，更何况日志一直在更新(每一行日志都是钱)。

刚开始我也被困在了一个怪圈里面，Google搜索一直都是创建GPT分区保留现有MBR分区，后来发现根本不可能。创建GPT分区就会删除磁盘上的所有数据，而且MBR分区和GPT分区相互不兼容，思维走到绝路了。

至于MBR分区转换到GPT分区这个方法是怎么发现的，我在查看阿里云的帮助文档的时候发现的(百度云上面竟然没有找到相关介绍，果然还得是良心云的帮助文档全面，也有可能百度云有相关的文档没让我发现而已)。这样做的方式就是需要umount现在已经挂载的硬盘，意味着我们每分钟都在赚钱的业务需要中断。

既然需要中断业务了自然要跟领导商量，领导的态度也很坚决，不行绝对不行。实际上我也不乐意中断业务，前几天跟老板吃饭刚给了指标，那就是一年里面业务不能中断多长时间，有可能这一次的操作就让我超出了这个指标。如果说超出有什么后果，后果就是我的年终奖没有了，所以我也不同意。

问题还是要解决的，不然公司的钱不是白花了。经过了长时间的友好协商，最终我跟领导都趋向了一个解决方案，暂时先不要管了，没事多清理磁盘空间坚持一下，等业务可以中断的时候再去解决。

## 实际命令(谨慎操作未经验证)

在网上搜索会有两种方式，一种是使用parted还有一种是使用gdisk。因为我的环境现在并不能直接动，所以暂时还没有具体实践。如果大家看到这里，可以参考一下文章，请注意：

**一定要注意备份文件不然丢失数据概不负责**

**一定要注意备份文件不然丢失数据概不负责**

**一定要注意备份文件不然丢失数据概不负责**

<https://cloud.tencent.com/developer/article/1175328>

<https://www.zywvvd.com/notes/system/linux/disk/gdisk/gdisk/>